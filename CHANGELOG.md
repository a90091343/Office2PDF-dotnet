# Changelog

All notable changes to Office2PDF will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [5.1.0] - 2025-08-30

**贡献者**: azhan (感谢 GitHub Copilot 协助)

### Added

- **转换结果汇总功能** - 显示总文件数、成功数、失败数的详细统计
- **失败文件列表** - 完整列出所有转换失败的文件路径，便于问题定位
- **成功提示** - 全部转换成功时显示祝贺信息
- **撤回功能增强** - 支持一键撤回所有更改，恢复原始状态
- **增强的构建脚本** - 支持Visual Studio 2025及更全面的VS版本检测
- **智能路径处理** - 自动去除复制路径中的首尾引号，提升粘贴体验
- **自动目标生成** - 设置来源路径时自动生成目标路径（`来源路径_PDFs`）
- **增强路径验证** - 改进目标路径验证逻辑，支持无效路径的早期检测和友好提示

### Fixed

- **文件计数修复** - 转换进度显示从第1个文件开始计数，符合人类习惯（之前从0开始）
- **目标路径同步** - 修复拖拽更换来源文件夹时目标路径不自动更新的问题
- **撤回逻辑修复** - 修复第一次转换时撤回功能无法正确恢复PDF文件的问题
- **撤回功能重大修复** - 修复第一次转换时撤回功能逻辑错误的问题
- **按钮状态修复** - 修复路径验证过于严格导致按钮无法启用的问题
- **构建配置优化** - 移除冗余的TargetFrameworkVersion参数，使用项目文件配置
- **编译警告清理** - 清理未使用变量和调试代码

### Improved

- **用户体验** - 更清晰的转换结果反馈，包含emoji图标增强可读性
- **路径处理** - 自动去除复制路径中的引号，提升粘贴体验
- **自动路径生成** - 设置来源路径时自动生成目标路径（`来源路径_PDFs`）
- **按钮样式** - 优化"开始"按钮的大小和字体，提升视觉效果
- **错误处理** - 更详细的编译错误提示和故障排除建议
### Improved

- **UI布局优化** - 重新设计按钮布局，开始按钮居中且更宽，撤回按钮右对齐
- **视觉效果增强** - 优化开始按钮字体大小和粗细，提升视觉效果  
- **项目结构清理** - 删除无用文件，整理代码结构，为发布做准备
- **文档架构重构** - 分离README和CHANGELOG职责，提升文档专业性
- **代码质量** - 清理了冗余的版本支持注释，提高代码可维护性

## [5.0.0] - 2025-08-24

**贡献者**: azhan (感谢 GitHub Copilot 协助)  
**WPS 转换思路来源**: iOS-执著 ([WPSToPDF](https://gitee.com/BudStudio/WPSToPDF))

### Added

- **WPS Office 引擎支持** - 完整支持 WPS 文字、WPS 表格、WPS 演示的批量转换
- **双引擎切换** - 新增"引擎"单选项（MS Office / WPS Office），默认选择 WPS
- **Word 批注选项** - 新增"打印注释"选项，可控制是否包含修订批注
- **Excel Sheet 分离** - 新增"一个 Sheet 一个 PDF"模式，可按 Sheet 拆分输出多个 PDF
- **原文件删除** - 新增"删除原文件"选项，带确认弹窗 + 多次重试 + 进程清理
- **转换控制** - 转换按钮支持"开始/结束"切换，实现任务取消功能
- **环境检测增强** - WPS 环境检测使用正确 ProgID（KWps/KET/KWPP），避免误判

### Improved

- **界面优化** - 默认取消勾选 Excel，避免误触大批量表格转换
- **窗口布局** - 压缩窗口高度与布局，移除底部多余空白，界面更紧凑
- **日志系统** - 日志输出新增颜色区分（Info/Warning/Error），附带时间戳与阶段分隔
- **拖拽体验** - 拖拽区域提示文案清晰化，空路径时灰底提示
- **作者信息** - 更新作者信息，移除旧二维码弹出层，界面更简洁

### Fixed

- **COM 对象管理** - 全面梳理 MS Office 与 WPS 的 COM 生命周期管理
- **资源释放** - 文档/工作簿/演示文稿/Sheet 均显式关闭与释放
- **进程清理** - WPS Excel 每个 Sheet 导出后显式释放 COM 对象，减少内存占用
- **取消操作** - 安全的取消操作状态回收（按钮文字、令牌释放、列表清理）
- **删除重试** - 删除原文件逻辑包含渐进重试（属性重置、GC、进程清理）

### Technical

- **接口抽象** - 抽象 IOfficeApplication 接口 + 泛型 ConvertToPDF 方法
- **代码复用** - 统一三套文档类型的实现逻辑
- **参数绑定** - 按文档类型动态绑定参数（批注/Sheet拆分）
- **日志统一** - 日志统一入口 AppendLog + 级别枚举
- **属性联动** - ViewModel 属性变更链条更清晰，避免重复刷新

## [3.0.0] - 2025-05-29

**贡献者**: evgo2017

### Added

- 基于 .NET Framework 重构的全新版本
- 图形用户界面 (GUI)
- 批量转换功能
- 子文件夹递归处理
- 文件类型选择（Word/Excel/PPT）

### Technical

- 使用 WPF 框架构建用户界面
- COM 组件交互处理 Office 文档
- 完整的错误处理和日志系统

## [2.0.0] - 2020-08-26

**贡献者**: evgo2017

### Added

- GUI 界面
- 文件类型选择功能
- 子文件夹处理选项

## [1.0.0] - 2018-11-02

**贡献者**: evgo2017

### Added

- 基础的 Office 文档转 PDF 功能
- 命令行界面
- Word、Excel、PowerPoint 支持

---

## 版本号规则

### 功能更新记录 (记录在README.md中)

- **Major版本 (X.0.0)** - 重大功能变更、架构重构、破坏性更新
- **Minor版本 (X.Y.0)** - 新功能添加、重要特性增强

### 内部修复记录 (仅记录在CHANGELOG.md中)

- **Patch版本 (X.Y.Z)** - Bug修复、性能优化、小幅改进、文档更新
- **构建系统更新** - 编译脚本改进、依赖更新
- **代码质量改进** - 重构、注释优化、警告修复

### 更新策略

- 只有**功能更新**（Major/Minor）才会更新README.md的版本历史
- 所有变更都会记录在CHANGELOG.md中
- 遵循语义化版本规范 (Semantic Versioning)
