<Window x:Class="Office2PDF.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Office2PDF"
        mc:Ignorable="d"
        Title="Office2PDF 5 - 文档转换助手"
        Height="600"
        Width="635"
        MinHeight="480"
        MinWidth="500"
        WindowStartupLocation="CenterScreen"
        SizeToContent="Manual">
    <Grid Margin="10,7,10,7">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <GroupBox Header="文件夹"
                  Grid.Row="0"
                  Margin="0,5,0,0">
            <StackPanel>
                <Grid Margin="5,5,5,2"
                      AllowDrop="True"
                      Drop="FromFolder_Drop"
                      DragOver="Folder_DragOver"
                      Background="Transparent">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="80"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0"
                               VerticalAlignment="Center"
                               Text="来源："/>
                    <TextBox Grid.Column="1"
                             VerticalAlignment="Center"
                             Padding="2"
                             Text="{Binding FromRootFolderPath, UpdateSourceTrigger=PropertyChanged}"
                             AllowDrop="True"
                             Drop="FromFolder_Drop"
                             DragOver="Folder_DragOver"
                             PreviewDragOver="Folder_DragOver">
                        <TextBox.Style>
                            <Style TargetType="TextBox">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding FromRootFolderPath}"
                                                 Value="">
                                        <Setter Property="Background"
                                                Value="LightGray"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding FromRootFolderPath}"
                                                 Value="{x:Null}">
                                        <Setter Property="Background"
                                                Value="LightGray"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBox.Style>
                    </TextBox>
                    <TextBlock Grid.Column="1"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Center"
                               Text="请拖拽源文件夹到此处"
                               Foreground="Gray"
                               IsHitTestVisible="False">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Visibility"
                                        Value="Collapsed"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding FromRootFolderPath}"
                                                 Value="">
                                        <Setter Property="Visibility"
                                                Value="Visible"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding FromRootFolderPath}"
                                                 Value="{x:Null}">
                                        <Setter Property="Visibility"
                                                Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                    <Button Grid.Column="2"
                            HorizontalAlignment="Stretch"
                            Margin="5,0,0,0"
                            Padding="2"
                            Content="选择"
                            Click="BrowseFromFolder_Click"/>
                    <Button Grid.Column="3"
                            HorizontalAlignment="Stretch"
                            Margin="5,0,0,0"
                            Padding="2"
                            Content="打开"
                            Click="OpenFromFolder_Click"/>
                </Grid>
                <Grid Margin="5,2,5,5"
                      AllowDrop="True"
                      Drop="ToFolder_Drop"
                      DragOver="Folder_DragOver"
                      Background="Transparent">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="80"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0"
                               VerticalAlignment="Center"
                               Text="目标："/>
                    <TextBox Grid.Column="1"
                             VerticalAlignment="Center"
                             Padding="2"
                             Text="{Binding ToRootFolderPath, UpdateSourceTrigger=PropertyChanged}"
                             AllowDrop="True"
                             Drop="ToFolder_Drop"
                             DragOver="Folder_DragOver"
                             PreviewDragOver="Folder_DragOver">
                        <TextBox.Style>
                            <Style TargetType="TextBox">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding ToRootFolderPath}"
                                                 Value="">
                                        <Setter Property="Background"
                                                Value="LightGray"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding ToRootFolderPath}"
                                                 Value="{x:Null}">
                                        <Setter Property="Background"
                                                Value="LightGray"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBox.Style>
                    </TextBox>
                    <TextBlock Grid.Column="1"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Center"
                               Text="请拖拽目标文件夹到此处"
                               Foreground="Gray"
                               IsHitTestVisible="False">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Visibility"
                                        Value="Collapsed"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding ToRootFolderPath}"
                                                 Value="">
                                        <Setter Property="Visibility"
                                                Value="Visible"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding ToRootFolderPath}"
                                                 Value="{x:Null}">
                                        <Setter Property="Visibility"
                                                Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                    <Button Grid.Column="2"
                            HorizontalAlignment="Stretch"
                            Margin="5,0,0,0"
                            Padding="2"
                            Content="选择"
                            Click="BrowseToFolder_Click"/>
                    <Button Grid.Column="3"
                            HorizontalAlignment="Stretch"
                            Margin="5,0,0,0"
                            Padding="2"
                            Content="打开"
                            Click="OpenToFolder_Click"/>
                </Grid>

                <!-- 子文件夹选项合并到这里 -->
                <Rectangle Height="1"
                           Fill="LightGray"
                           Margin="5,3,5,3"/>
                <StackPanel Orientation="Horizontal"
                            Margin="5,0,5,0">
                    <TextBlock Text="子文件夹："
                               VerticalAlignment="Center"
                               Margin="0,0,10,0"/>
                    <RadioButton Content="转换"
                                 MinWidth="0"
                                 VerticalContentAlignment="Center"
                                 Margin="0,0,7,0"
                                 GroupName="ConvertChildrenFolder"
                                 IsChecked="{Binding IsConvertChildrenFolder, UpdateSourceTrigger=PropertyChanged}"/>
                    <RadioButton Content="不转换"
                                 MinWidth="0"
                                 VerticalContentAlignment="Center"
                                 Margin="0,0,15,0"
                                 GroupName="ConvertChildrenFolder"/>
                    <!-- 竖线分隔符 -->
                    <Rectangle Width="1"
                               Height="20"
                               Fill="Gray"
                               Margin="10,2"/>
                    <TextBlock Text="目录结构："
                               VerticalAlignment="Center"
                               Margin="0,0,10,0"
                               IsEnabled="{Binding IsConvertChildrenFolder, UpdateSourceTrigger=PropertyChanged}">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsConvertChildrenFolder}"
                                                 Value="False">
                                        <Setter Property="Foreground"
                                                Value="Gray"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                    <RadioButton Content="保持"
                                 MinWidth="0"
                                 VerticalContentAlignment="Center"
                                 Margin="0,0,7,0"
                                 GroupName="KeepFolderStructure"
                                 IsChecked="{Binding IsKeepFolderStructure, UpdateSourceTrigger=PropertyChanged}"
                                 IsEnabled="{Binding IsConvertChildrenFolder, UpdateSourceTrigger=PropertyChanged}"/>
                    <RadioButton Content="平铺"
                                 MinWidth="0"
                                 VerticalContentAlignment="Center"
                                 GroupName="KeepFolderStructure"
                                 IsEnabled="{Binding IsConvertChildrenFolder, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>
            </StackPanel>
        </GroupBox>

        <UniformGrid Grid.Row="1"
                     Columns="2"
                     Margin="0,5,0,0">
            <GroupBox Header="转换类型"
                      Margin="0,0,2,0"
                      Padding="5">
                <StackPanel>
                    <StackPanel Orientation="Horizontal"
                                Margin="0,0,0,5">
                        <CheckBox Content="Word"
                                  MinWidth="0"
                                  VerticalContentAlignment="Center"
                                  Margin="0,0,7,0"
                                  IsChecked="{Binding IsConvertWord, UpdateSourceTrigger=PropertyChanged}"/>
                        <CheckBox Content="PPT"
                                  MinWidth="0"
                                  VerticalContentAlignment="Center"
                                  Margin="0,0,7,0"
                                  IsChecked="{Binding IsConvertPPT, UpdateSourceTrigger=PropertyChanged}"/>
                        <CheckBox Content="Excel"
                                  MinWidth="0"
                                  VerticalContentAlignment="Center"
                                  Margin="0,0,7,0"
                                  IsChecked="{Binding IsConvertExcel, UpdateSourceTrigger=PropertyChanged}"/>
                        <CheckBox Content="全选"
                                  MinWidth="0"
                                  VerticalContentAlignment="Center"
                                  IsChecked="{Binding IsConvertAll, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>
                    <Rectangle Height="1"
                               Fill="LightGray"
                               Margin="0,2"/>
                    <StackPanel Orientation="Horizontal"
                                Margin="0,5,0,0">
                        <Button Background="#E6F3FF"
                                BorderBrush="#4A90E2"
                                BorderThickness="1"
                                Width="16"
                                Height="16"
                                Margin="0,0,5,0"
                                VerticalAlignment="Center"
                                Cursor="Help"
                                Click="HelpButton_Click"
                                Name="EngineHelpButton">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}"
                                            BorderBrush="{TemplateBinding BorderBrush}"
                                            BorderThickness="{TemplateBinding BorderThickness}"
                                            CornerRadius="10">
                                        <ContentPresenter HorizontalAlignment="Center"
                                                          VerticalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Button.Template>
                            <TextBlock Text="?"
                                       FontFamily="Segoe UI"
                                       FontSize="10"
                                       FontWeight="Bold"
                                       Foreground="#4A90E2"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"/>
                        </Button>
                        <TextBlock Text="引擎："
                                   VerticalAlignment="Center"
                                   Margin="0,0,5,0"
                                   FontSize="11"/>
                        <StackPanel Orientation="Horizontal">
                            <RadioButton Content="自动（推荐）"
                                         MinWidth="0"
                                         VerticalContentAlignment="Center"
                                         Margin="0,0,10,0"
                                         GroupName="OfficeEngine"
                                         IsChecked="{Binding UseWpsOffice, Converter={x:Static local:InverseBooleanConverter.Instance}, UpdateSourceTrigger=PropertyChanged}"
                                         FontSize="11"/>
                            <Popup Name="EngineHelpPopup"
                                   PlacementTarget="{Binding ElementName=EngineHelpButton}"
                                   Placement="Bottom"
                                   StaysOpen="False"
                                   PopupAnimation="Fade">
                                <Border Background="#F8F9FA"
                                        BorderBrush="#4A90E2"
                                        BorderThickness="1"
                                        CornerRadius="5"
                                        MaxWidth="350">
                                    <Border.Effect>
                                        <DropShadowEffect Color="Gray"
                                                          BlurRadius="10"
                                                          ShadowDepth="3"
                                                          Opacity="0.3"/>
                                    </Border.Effect>
                                    <StackPanel Margin="12">
                                        <TextBlock Text="Office 引擎选择"
                                                   FontWeight="Bold"
                                                   FontSize="12"
                                                   Foreground="#2C3E50"
                                                   Margin="0,0,0,8"/>
                                        <TextBlock TextWrapping="Wrap"
                                                   FontSize="11"
                                                   Foreground="#34495E"
                                                   LineHeight="18">
                                            <Run Text="▸ 自动"
                                                    FontWeight="Bold"/><LineBreak/>
                                            <Run Text="  • 若只安装了 MS Office，则使用 MS Office 引擎"/><LineBreak/>
                                            <Run Text="  • 若只安装了 WPS Office，则使用 WPS Office 引擎"/><LineBreak/>
                                            <Run Text="  • 若同时安装了两者，则使用在系统注册表HKCU中注册的引擎"/><LineBreak/><LineBreak/>
                                            <Run Text="  💡 "
                                                    FontWeight="Bold"/>
                                            <Run Text="提示：当 MS Office 与 WPS Office 共存时，若用户安装 WPS 时勾选了“修改相关系统配置使 WPS 兼容第三方系统和软件”，那么 COM 自动化接口会被 WPS 接管，程序会自动检测并提示。"
                                                    FontStyle="Italic"
                                                    Foreground="#7F8C8D"/><LineBreak/><LineBreak/>
                                            <Run Text="▸ WPS"
                                                    FontWeight="Bold"/><LineBreak/>
                                            <Run Text="  强制使用 WPS Office 引擎进行转换。"/><LineBreak/><LineBreak/>
                                            <Run Text="  ⚠️ "
                                                    FontWeight="Bold"/>
                                            <Run Text="注意：使用此引擎进行批量转换后，系统后台可能会残留数个wps.exe进程。若重复操作，残留的进程会不断累积。"
                                                    FontStyle="Italic"
                                                    Foreground="#7F8C8D"/>
                                        </TextBlock>
                                    </StackPanel>
                                </Border>
                            </Popup>
                        </StackPanel>
                        <RadioButton Content="WPS"
                                     MinWidth="0"
                                     VerticalContentAlignment="Center"
                                     GroupName="OfficeEngine"
                                     IsChecked="{Binding UseWpsOffice, UpdateSourceTrigger=PropertyChanged}"
                                     FontSize="11"/>
                    </StackPanel>
                </StackPanel>
            </GroupBox>

            <!-- 文件处理 -->
            <GroupBox Header="文件处理"
                      Margin="2,0,0,0"
                      Padding="5">
                <StackPanel>
                    <CheckBox Content="删除原文件"
                              MinWidth="0"
                              VerticalContentAlignment="Center"
                              IsChecked="{Binding IsDeleteOriginalFiles, UpdateSourceTrigger=PropertyChanged}"
                              HorizontalAlignment="Left"/>

                    <StackPanel Orientation="Horizontal"
                                Margin="0,5,0,0">
                        <TextBlock Text="目标文件已存在时："
                                   VerticalAlignment="Center"
                                   Margin="0,0,5,0"/>
                        <ComboBox Name="DuplicateFileActionCombo"
                                  MinWidth="100"
                                  VerticalAlignment="Center"
                                  SelectionChanged="DuplicateFileActionCombo_SelectionChanged">
                            <ComboBoxItem Content="重命名"
                                          Tag="Rename"/>
                            <ComboBoxItem Content="跳过"
                                          Tag="Skip"/>
                            <ComboBoxItem Content="覆盖"
                                          Tag="Overwrite"/>
                        </ComboBox>
                    </StackPanel>
                </StackPanel>
            </GroupBox>
        </UniformGrid>

        <GroupBox Header="配置项"
                  Grid.Row="2"
                  Margin="0,5,0,0"
                  Padding="5">
            <StackPanel>
                <!-- Word配置 -->
                <StackPanel Orientation="Horizontal"
                            Margin="0,0,0,5">
                    <TextBlock Text="Word："
                               VerticalAlignment="Center"
                               Margin="0,0,5,0"
                               FontWeight="Bold"
                               MinWidth="50"/>
                    <CheckBox Content="打印批注与修订标记"
                              MinWidth="0"
                              VerticalContentAlignment="Center"
                              IsChecked="{Binding IsPrintRevisionsInWord, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>
                <!-- Excel配置 -->
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Excel："
                               VerticalAlignment="Center"
                               Margin="0,0,5,0"
                               FontWeight="Bold"
                               MinWidth="50"/>
                    <CheckBox Content="一个Sheet一个PDF"
                              MinWidth="0"
                              VerticalContentAlignment="Center"
                              IsChecked="{Binding IsConvertOneSheetOnePDFInExcel, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>
            </StackPanel>
        </GroupBox>

        <Grid Grid.Row="3"
              Margin="0,5,0,0">

            <Button IsEnabled="{Binding CanStartConvert}"
                    Content="{Binding ButtonText}"
                    VerticalAlignment="Top"
                    Padding="8"
                    Click="StartConvert_Click"
                    MinWidth="200"
                    HorizontalAlignment="Center"
                    FontSize="14"
                    FontWeight="SemiBold"/>

            <Button x:Name="UndoButton"
                    Content="撤回更改"
                    VerticalAlignment="Top"
                    Padding="8"
                    Click="UndoChanges_Click"
                    MinWidth="70"
                    IsEnabled="False"
                    ToolTip="撤回本次转换产生的所有文件更改（包括创建、覆盖、删除的文件）"
                    HorizontalAlignment="Right"/>
        </Grid>

        <GroupBox Header="日志"
                  Grid.Row="4"
                  Margin="0,5,0,0"
                  Padding="3">
            <RichTextBox x:Name="LogRichTextBox"
                         IsReadOnly="True"
                         VerticalScrollBarVisibility="Auto"
                         Padding="2 9"
                         MinHeight="150"/>
        </GroupBox>

        <!-- 版本号和关于按钮 - 位于整个界面的右下角 -->
        <Grid Grid.Row="4"
              HorizontalAlignment="Right"
              VerticalAlignment="Bottom"
              Margin="0,0,30,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Column="0"
                       Text="{Binding VersionNumber, StringFormat='v{0}'}"
                       Foreground="#888888"
                       FontSize="11"
                       VerticalAlignment="Center"
                       Margin="0,0,5,0"/>

            <Button Grid.Column="1"
                    x:Name="AboutButton"
                    Content="关于"
                    FontSize="11"
                    Padding="8,2"
                    MinWidth="0"
                    MinHeight="0"
                    Click="AboutButton_Click"
                    Background="Transparent"
                    BorderBrush="#CCCCCC"
                    BorderThickness="1"
                    Cursor="Hand"/>
        </Grid>
    </Grid>
</Window>



